<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forex & XAUUSD Trading Signals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .signal-buy {
            background-color: #d1fae5;
            color: #065f46;
        }
        .signal-sell {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .signal-hold {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .price-up {
            color: #10b981;
        }
        .price-down {
            color: #ef4444;
        }
        .price-neutral {
            color: #6b7280;
        }
        .blink {
            animation: blink-animation 1s steps(2, start) infinite;
        }
        @keyframes blink-animation {
            to {
                visibility: hidden;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-blue-800">Forex & XAUUSD Trading Signals</h1>
            <p class="text-gray-600">Real-time market data and trading signals</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Left Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Symbol Selection -->
                <div class="bg-white rounded-lg shadow p-4">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Select Symbol</h2>
                    <div class="flex space-x-2 mb-4">
                        <select id="symbolSelect" class="flex-grow p-2 border rounded">
                            <option value="">Loading symbols...</option>
                        </select>
                        <button id="refreshBtn" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div class="flex space-x-2">
                        <button id="addFavorite" class="bg-yellow-500 text-white p-2 rounded hover:bg-yellow-600 flex-grow">
                            <i class="fas fa-star mr-2"></i>Add Favorite
                        </button>
                        <button id="clearFavorites" class="bg-gray-500 text-white p-2 rounded hover:bg-gray-600">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    
                    <div id="favoritesList" class="mt-4 space-y-2">
                        <h3 class="font-medium text-gray-700">Favorites</h3>
                        <!-- Favorites will be added here dynamically -->
                    </div>
                </div>

                <!-- Market Movers -->
                <div class="bg-white rounded-lg shadow p-4">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Market Movers</h2>
                    <div id="marketMovers" class="space-y-3">
                        <div class="animate-pulse flex space-x-4">
                            <div class="flex-1 space-y-2 py-1">
                                <div class="h-4 bg-gray-300 rounded"></div>
                                <div class="h-4 bg-gray-300 rounded"></div>
                                <div class="h-4 bg-gray-300 rounded"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="lg:col-span-3 space-y-6">
                <!-- Price Display -->
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">
                            <span id="currentSymbol">XAU/USD</span> - 
                            <span id="currentPrice" class="text-2xl font-bold">Loading...</span>
                            <span id="priceChange" class="text-sm ml-2"></span>
                        </h2>
                        <div class="text-sm text-gray-500">
                            Last updated: <span id="lastUpdated">-</span>
                        </div>
                    </div>
                    
                    <!-- Mini Chart -->
                    <div class="h-64 mb-4">
                        <div id="tradingview-chart" class="h-full"></div>
                    </div>
                    
                    <!-- Timeframes -->
                    <div class="flex space-x-2 overflow-x-auto py-2">
                        <button data-interval="1min" class="timeframe-btn bg-blue-100 text-blue-800 px-3 py-1 rounded">1m</button>
                        <button data-interval="5min" class="timeframe-btn bg-blue-500 text-white px-3 py-1 rounded">5m</button>
                        <button data-interval="15min" class="timeframe-btn bg-blue-100 text-blue-800 px-3 py-1 rounded">15m</button>
                        <button data-interval="30min" class="timeframe-btn bg-blue-100 text-blue-800 px-3 py-1 rounded">30m</button>
                        <button data-interval="1h" class="timeframe-btn bg-blue-100 text-blue-800 px-3 py-1 rounded">1h</button>
                        <button data-interval="4h" class="timeframe-btn bg-blue-100 text-blue-800 px-3 py-1 rounded">4h</button>
                        <button data-interval="1day" class="timeframe-btn bg-blue-100 text-blue-800 px-3 py-1 rounded">1D</button>
                    </div>
                </div>

                <!-- Trading Signals -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- RSI Signal -->
                    <div id="rsiSignal" class="signal-hold rounded-lg shadow p-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-lg font-semibold">RSI (14)</h3>
                            <span class="signal-value text-xl font-bold">-</span>
                        </div>
                        <div class="signal-status h-24 flex items-center justify-center rounded-lg mb-3">
                            <span class="text-2xl font-bold">HOLD</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-white p-2 rounded">TP: <span class="tp-value font-medium">-</span></div>
                            <div class="bg-white p-2 rounded">SL: <span class="sl-value font-medium">-</span></div>
                        </div>
                    </div>
                    
                    <!-- MACD Signal -->
                    <div id="macdSignal" class="signal-hold rounded-lg shadow p-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-lg font-semibold">MACD</h3>
                            <span class="signal-value text-sm">-</span>
                        </div>
                        <div class="signal-status h-24 flex items-center justify-center rounded-lg mb-3">
                            <span class="text-2xl font-bold">HOLD</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-white p-2 rounded">TP: <span class="tp-value font-medium">-</span></div>
                            <div class="bg-white p-2 rounded">SL: <span class="sl-value font-medium">-</span></div>
                        </div>
                    </div>
                    
                    <!-- SMA Signal -->
                    <div id="smaSignal" class="signal-hold rounded-lg shadow p-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-lg font-semibold">SMA (50)</h3>
                            <span class="signal-value text-xl font-bold">-</span>
                        </div>
                        <div class="signal-status h-24 flex items-center justify-center rounded-lg mb-3">
                            <span class="text-2xl font-bold">HOLD</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-white p-2 rounded">TP: <span class="tp-value font-medium">-</span></div>
                            <div class="bg-white p-2 rounded">SL: <span class="sl-value font-medium">-</span></div>
                        </div>
                    </div>
                    
                    <!-- Bollinger Bands Signal -->
                    <div id="bbSignal" class="signal-hold rounded-lg shadow p-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-lg font-semibold">Bollinger Bands</h3>
                            <span class="signal-value text-sm">-</span>
                        </div>
                        <div class="signal-status h-24 flex items-center justify-center rounded-lg mb-3">
                            <span class="text-2xl font-bold">HOLD</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-white p-2 rounded">TP: <span class="tp-value font-medium">-</span></div>
                            <div class="bg-white p-2 rounded">SL: <span class="sl-value font-medium">-</span></div>
                        </div>
                    </div>
                </div>

                <!-- EOD Data -->
                <div class="bg-white rounded-lg shadow p-4">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">End of Day Data</h2>
                    <div id="eodData" class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="py-2 px-4 text-left">Date</th>
                                    <th class="py-2 px-4 text-right">Open</th>
                                    <th class="py-2 px-4 text-right">High</th>
                                    <th class="py-2 px-4 text-right">Low</th>
                                    <th class="py-2 px-4 text-right">Close</th>
                                    <th class="py-2 px-4 text-right">Volume</th>
                                </tr>
                            </thead>
                            <tbody id="eodTableBody">
                                <tr>
                                    <td colspan="6" class="py-4 text-center text-gray-500">Loading EOD data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_KEY = '6df84484de0e4146afc6fef58fbc9123';
        let currentSymbol = 'XAU/USD';
        let currentInterval = '5min';
        let previousPrice = 0;
        let priceChart = null;
        let tvWidget = null;
        let forexPairs = [];

        // DOM Elements
        const symbolSelect = document.getElementById('symbolSelect');
        const currentSymbolEl = document.getElementById('currentSymbol');
        const currentPriceEl = document.getElementById('currentPrice');
        const priceChangeEl = document.getElementById('priceChange');
        const lastUpdatedEl = document.getElementById('lastUpdated');
        const refreshBtn = document.getElementById('refreshBtn');
        const addFavoriteBtn = document.getElementById('addFavorite');
        const clearFavoritesBtn = document.getElementById('clearFavorites');
        const favoritesList = document.getElementById('favoritesList');
        const timeframeBtns = document.querySelectorAll('.timeframe-btn');
        const marketMoversEl = document.getElementById('marketMovers');
        const eodTableBody = document.getElementById('eodTableBody');

        // Signal elements
        const rsiSignal = document.getElementById('rsiSignal');
        const macdSignal = document.getElementById('macdSignal');
        const smaSignal = document.getElementById('smaSignal');
        const bbSignal = document.getElementById('bbSignal');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadForexPairs();
            loadMarketMovers();
            setupEventListeners();
            loadFavorites();
            
            // Initial data load
            updatePrice();
            updateSignalsAndEOD();

            // Set up auto-refresh intervals
            setInterval(updatePrice, 20000); // Refresh price every 20 seconds
            setInterval(updateSignalsAndEOD, 60000); // Refresh signals and EOD every 60 seconds
        });

        // Set up event listeners
        function setupEventListeners() {
            symbolSelect.addEventListener('change', function() {
                currentSymbol = this.value;
                currentSymbolEl.textContent = currentSymbol;
                updatePrice();
                updateSignalsAndEOD();
                updateChart();
            });

            refreshBtn.addEventListener('click', function() {
                updatePrice();
                updateSignalsAndEOD();
                // Add visual feedback
                this.classList.add('animate-spin');
                setTimeout(() => {
                    this.classList.remove('animate-spin');
                }, 1000);
            });

            addFavoriteBtn.addEventListener('click', addToFavorites);
            clearFavoritesBtn.addEventListener('click', clearFavorites);

            timeframeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    currentInterval = this.dataset.interval;
                    // Update active button styling
                    timeframeBtns.forEach(b => b.classList.remove('bg-blue-500', 'text-white'));
                    timeframeBtns.forEach(b => b.classList.add('bg-blue-100', 'text-blue-800'));
                    this.classList.remove('bg-blue-100', 'text-blue-800');
                    this.classList.add('bg-blue-500', 'text-white');
                    
                    updateSignals();
                });
            });
        }

        // Load forex pairs from API
        async function loadForexPairs() {
            try {
                const response = await fetch(`https://api.twelvedata.com/forex_pairs?apikey=${API_KEY}`);
                const data = await response.json();
                
                if (data.data) {
                    forexPairs = data.data;
                    populateSymbolSelect(forexPairs);
                } else {
                    console.error('Error loading forex pairs:', data.message || 'Unknown error');
                }
            } catch (error) {
                console.error('Error loading forex pairs:', error);
            }
        }

        // Populate symbol dropdown
        function populateSymbolSelect(pairs) {
            symbolSelect.innerHTML = '';
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select a symbol';
            symbolSelect.appendChild(defaultOption);
            
            // Group by base currency
            const groupedPairs = {};
            pairs.forEach(pair => {
                if (!groupedPairs[pair.currency_base]) {
                    groupedPairs[pair.currency_base] = [];
                }
                groupedPairs[pair.currency_base].push(pair);
            });
            
            // Add options grouped by base currency
            for (const baseCurrency in groupedPairs) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = baseCurrency;
                
                groupedPairs[baseCurrency].forEach(pair => {
                    const option = document.createElement('option');
                    option.value = pair.symbol;
                    option.textContent = `${pair.symbol} (${pair.currency_group})`;
                    if (pair.symbol === 'XAU/USD') {
                        option.selected = true;
                    }
                    optgroup.appendChild(option);
                });
                
                symbolSelect.appendChild(optgroup);
            }
        }

        // Load market movers data
        async function loadMarketMovers() {
            try {
                const response = await fetch(`https://api.twelvedata.com/market_movers/stocks?apikey=${API_KEY}`);
                const data = await response.json();
                
                if (data.data && data.data.gainers && data.data.losers) {
                    displayMarketMovers(data.data);
                } else {
                    marketMoversEl.innerHTML = '<div class="text-red-500">Error loading market movers</div>';
                }
            } catch (error) {
                console.error('Error loading market movers:', error);
                marketMoversEl.innerHTML = '<div class="text-red-500">Error loading market movers</div>';
            }
        }

        // Display market movers
        function displayMarketMovers(data) {
            // Combine top 3 gainers and losers
            const movers = [
                ...data.gainers.slice(0, 3).map(item => ({...item, type: 'gainers'})),
                ...data.losers.slice(0, 3).map(item => ({...item, type: 'losers'}))
            ];
            
            let html = '';
            movers.forEach(item => {
                const changeClass = item.type === 'gainers' ? 'text-green-600' : 'text-red-600';
                const changeIcon = item.type === 'gainers' ? 'fa-arrow-up' : 'fa-arrow-down';
                
                html += `
                    <div class="flex justify-between items-center p-2 border-b">
                        <div>
                            <span class="font-medium">${item.symbol}</span>
                            <span class="text-sm text-gray-500 ml-2">${item.name}</span>
                        </div>
                        <div class="${changeClass}">
                            <i class="fas ${changeIcon} mr-1"></i>
                            ${item.percent_change}%
                        </div>
                    </div>
                `;
            });
            
            marketMoversEl.innerHTML = html;
        }

        // Update signals and EOD data
        async function updateSignalsAndEOD() {
            try {
                updateSignals();
                updateEODData();
            } catch (error) {
                console.error('Error updating signals and EOD data:', error);
            }
        }

        // Update current price
        async function updatePrice() {
            try {
                const response = await fetch(`https://api.twelvedata.com/price?symbol=${currentSymbol}&apikey=${API_KEY}`);
                const data = await response.json();
                
                if (data.price) {
                    const currentPrice = parseFloat(data.price);
                    currentPriceEl.textContent = currentPrice.toFixed(5);
                    
                    // Update price change indicator
                    if (previousPrice > 0) {
                        const change = currentPrice - previousPrice;
                        const changePercent = (change / previousPrice * 100).toFixed(2);
                        
                        if (change > 0) {
                            priceChangeEl.textContent = `+${change.toFixed(5)} (${changePercent}%)`;
                            priceChangeEl.className = 'text-sm ml-2 price-up';
                            currentPriceEl.classList.add('price-up');
                            currentPriceEl.classList.remove('price-down', 'price-neutral');
                        } else if (change < 0) {
                            priceChangeEl.textContent = `${change.toFixed(5)} (${changePercent}%)`;
                            priceChangeEl.className = 'text-sm ml-2 price-down';
                            currentPriceEl.classList.add('price-down');
                            currentPriceEl.classList.remove('price-up', 'price-neutral');
                        } else {
                            priceChangeEl.textContent = '0.00000 (0.00%)';
                            priceChangeEl.className = 'text-sm ml-2 price-neutral';
                            currentPriceEl.classList.add('price-neutral');
                            currentPriceEl.classList.remove('price-up', 'price-down');
                        }
                        
                        // Add blink effect if price changed significantly
                        if (Math.abs(change) > 0.0001) {
                            currentPriceEl.classList.add('blink');
                            setTimeout(() => {
                                currentPriceEl.classList.remove('blink');
                            }, 2000);
                        }
                    }
                    
                    previousPrice = currentPrice;
                    lastUpdatedEl.textContent = new Date().toLocaleTimeString();
                } else {
                    currentPriceEl.textContent = 'Error';
                    priceChangeEl.textContent = '';
                    console.error('Error fetching price:', data.message || 'Unknown error');
                }
            } catch (error) {
                console.error('Error fetching price:', error);
                currentPriceEl.textContent = 'Error';
                priceChangeEl.textContent = '';
            }
        }

        // Update trading signals
        async function updateSignals() {
            try {
                // RSI
                const rsiResponse = await fetch(`https://api.twelvedata.com/technical_indicators?symbol=${currentSymbol}&interval=${currentInterval}&type=rsi&apikey=${API_KEY}`);
                const rsiData = await rsiResponse.json();
                updateRSISignal(rsiData);
                
                // MACD
                const macdResponse = await fetch(`https://api.twelvedata.com/technical_indicators?symbol=${currentSymbol}&interval=${currentInterval}&type=macd&apikey=${API_KEY}`);
                const macdData = await macdResponse.json();
                updateMACDSignal(macdData);
                
                // SMA
                const smaResponse = await fetch(`https://api.twelvedata.com/technical_indicators?symbol=${currentSymbol}&interval=${currentInterval}&type=sma&apikey=${API_KEY}`);
                const smaData = await smaResponse.json();
                updateSMASignal(smaData);
                
                // Bollinger Bands
                const bbResponse = await fetch(`https://api.twelvedata.com/technical_indicators?symbol=${currentSymbol}&interval=${currentInterval}&type=bbands&apikey=${API_KEY}`);
                const bbData = await bbResponse.json();
                updateBBSignal(bbData);
            } catch (error) {
                console.error('Error fetching signals:', error);
            }
        }

        // Update RSI signal
        function updateRSISignal(data) {
            if (data.values && data.values.length > 0) {
                const rsiValue = parseFloat(data.values[0].rsi);
                const signalValueEl = rsiSignal.querySelector('.signal-value');
                const signalStatusEl = rsiSignal.querySelector('.signal-status');
                const tpValueEl = rsiSignal.querySelector('.tp-value');
                const slValueEl = rsiSignal.querySelector('.sl-value');
                
                signalValueEl.textContent = rsiValue.toFixed(2);
                
                // Determine signal
                let signal, signalClass;
                if (rsiValue < 30) {
                    signal = 'BUY';
                    signalClass = 'signal-buy';
                    tpValueEl.textContent = (previousPrice * 1.02).toFixed(5);
                    slValueEl.textContent = (previousPrice * 0.98).toFixed(5);
                } else if (rsiValue > 70) {
                    signal = 'SELL';
                    signalClass = 'signal-sell';
                    tpValueEl.textContent = (previousPrice * 0.98).toFixed(5);
                    slValueEl.textContent = (previousPrice * 1.02).toFixed(5);
                } else {
                    signal = 'HOLD';
                    signalClass = 'signal-hold';
                    tpValueEl.textContent = '-';
                    slValueEl.textContent = '-';
                }
                
                // Update UI
                signalStatusEl.textContent = signal;
                rsiSignal.className = `${signalClass} rounded-lg shadow p-4`;
            }
        }

        // Update MACD signal
        function updateMACDSignal(data) {
            if (data.values && data.values.length > 0) {
                const macdValue = parseFloat(data.values[0].macd);
                const signalLine = parseFloat(data.values[0].signal);
                const histogram = parseFloat(data.values[0].histogram);
                
                const signalValueEl = macdSignal.querySelector('.signal-value');
                const signalStatusEl = macdSignal.querySelector('.signal-status');
                const tpValueEl = macdSignal.querySelector('.tp-value');
                const slValueEl = macdSignal.querySelector('.sl-value');
                
                signalValueEl.textContent = `MACD: ${macdValue.toFixed(5)}, Signal: ${signalLine.toFixed(5)}`;
                
                // Determine signal
                let signal, signalClass;
                if (macdValue > signalLine && histogram > 0) {
                    signal = 'BUY';
                    signalClass = 'signal-buy';
                    tpValueEl.textContent = (previousPrice * 1.03).toFixed(5);
                    slValueEl.textContent = (previousPrice * 0.97).toFixed(5);
                } else if (macdValue < signalLine && histogram < 0) {
                    signal = 'SELL';
                    signalClass = 'signal-sell';
                    tpValueEl.textContent = (previousPrice * 0.97).toFixed(5);
                    slValueEl.textContent = (previousPrice * 1.03).toFixed(5);
                } else {
                    signal = 'HOLD';
                    signalClass = 'signal-hold';
                    tpValueEl.textContent = '-';
                    slValueEl.textContent = '-';
                }
                
                // Update UI
                signalStatusEl.textContent = signal;
                macdSignal.className = `${signalClass} rounded-lg shadow p-4`;
            }
        }

        // Update SMA signal
        function updateSMASignal(data) {
            if (data.values && data.values.length > 0) {
                const smaValue = parseFloat(data.values[0].sma);
                const signalValueEl = smaSignal.querySelector('.signal-value');
                const signalStatusEl = smaSignal.querySelector('.signal-status');
                const tpValueEl = smaSignal.querySelector('.tp-value');
                const slValueEl = smaSignal.querySelector('.sl-value');
                
                signalValueEl.textContent = smaValue.toFixed(5);
                
                // Determine signal based on price position relative to SMA
                let signal, signalClass;
                if (previousPrice > smaValue * 1.01) {
                    signal = 'BUY';
                    signalClass = 'signal-buy';
                    tpValueEl.textContent = (previousPrice * 1.015).toFixed(5);
                    slValueEl.textContent = smaValue.toFixed(5);
                } else if (previousPrice < smaValue * 0.99) {
                    signal = 'SELL';
                    signalClass = 'signal-sell';
                    tpValueEl.textContent = (previousPrice * 0.985).toFixed(5);
                    slValueEl.textContent = smaValue.toFixed(5);
                } else {
                    signal = 'HOLD';
                    signalClass = 'signal-hold';
                    tpValueEl.textContent = '-';
                    slValueEl.textContent = '-';
                }
                
                // Update UI
                signalStatusEl.textContent = signal;
                smaSignal.className = `${signalClass} rounded-lg shadow p-4`;
            }
        }

        // Update Bollinger Bands signal
        function updateBBSignal(data) {
            if (data.values && data.values.length > 0) {
                const upperBand = parseFloat(data.values[0].upper_band);
                const lowerBand = parseFloat(data.values[0].lower_band);
                const middleBand = parseFloat(data.values[0].middle_band);
                
                const signalValueEl = bbSignal.querySelector('.signal-value');
                const signalStatusEl = bbSignal.querySelector('.signal-status');
                const tpValueEl = bbSignal.querySelector('.tp-value');
                const slValueEl = bbSignal.querySelector('.sl-value');
                
                signalValueEl.textContent = `Upper: ${upperBand.toFixed(5)}, Lower: ${lowerBand.toFixed(5)}`;
                
                // Determine signal
                let signal, signalClass;
                if (previousPrice < lowerBand) {
                    signal = 'BUY';
                    signalClass = 'signal-buy';
                    tpValueEl.textContent = middleBand.toFixed(5);
                    slValueEl.textContent = (lowerBand * 0.99).toFixed(5);
                } else if (previousPrice > upperBand) {
                    signal = 'SELL';
                    signalClass = 'signal-sell';
                    tpValueEl.textContent = middleBand.toFixed(5);
                    slValueEl.textContent = (upperBand * 1.01).toFixed(5);
                } else {
                    signal = 'HOLD';
                    signalClass = 'signal-hold';
                    tpValueEl.textContent = '-';
                    slValueEl.textContent = '-';
                }
                
                // Update UI
                signalStatusEl.textContent = signal;
                bbSignal.className = `${signalClass} rounded-lg shadow p-4`;
            }
        }

        // Update EOD data
        async function updateEODData() {
            try {
                const response = await fetch(`https://api.twelvedata.com/eod?symbol=${currentSymbol}&apikey=${API_KEY}`);
                const data = await response.json();
                
                if (data.data && data.data.length > 0) {
                    displayEODData(data.data.slice(0, 10)); // Show last 10 days
                } else {
                    eodTableBody.innerHTML = '<tr><td colspan="6" class="py-4 text-center text-red-500">Error loading EOD data</td></tr>';
                }
            } catch (error) {
                console.error('Error fetching EOD data:', error);
                eodTableBody.innerHTML = '<tr><td colspan="6" class="py-4 text-center text-red-500">Error loading EOD data</td></tr>';
            }
        }

        // Display EOD data in table
        function displayEODData(eodData) {
            let html = '';
            eodData.forEach(item => {
                const date = new Date(item.datetime);
                const formattedDate = date.toLocaleDateString();
                
                html += `
                    <tr class="border-b">
                        <td class="py-2 px-4">${formattedDate}</td>
                        <td class="py-2 px-4 text-right">${parseFloat(item.open).toFixed(5)}</td>
                        <td class="py-2 px-4 text-right">${parseFloat(item.high).toFixed(5)}</td>
                        <td class="py-2 px-4 text-right">${parseFloat(item.low).toFixed(5)}</td>
                        <td class="py-2 px-4 text-right">${parseFloat(item.close).toFixed(5)}</td>
                        <td class="py-2 px-4 text-right">${item.volume || '-'}</td>
                    </tr>
                `;
            });
            
            eodTableBody.innerHTML = html;
        }

        // Update TradingView chart
        function updateChart() {
            if (tvWidget) {
                tvWidget.remove();
            }
            
            tvWidget = new TradingView.widget({
                autosize: true,
                symbol: currentSymbol,
                interval: currentInterval,
                timezone: "Etc/UTC",
                theme: "light",
                style: "1",
                locale: "en",
                toolbar_bg: "#f1f3f6",
                enable_publishing: false,
                allow_symbol_change: false,
                container_id: "tradingview-chart"
            });
        }

        // Favorites functionality
        function loadFavorites() {
            const favorites = JSON.parse(localStorage.getItem('forexFavorites')) || [];
            favoritesList.innerHTML = '<h3 class="font-medium text-gray-700">Favorites</h3>';
            
            if (favorites.length === 0) {
                favoritesList.innerHTML += '<p class="text-gray-500 text-sm">No favorites yet</p>';
            } else {
                favorites.forEach(symbol => {
                    addFavoriteToDOM(symbol);
                });
            }
        }

        function addToFavorites() {
            if (!currentSymbol) return;
            
            const favorites = JSON.parse(localStorage.getItem('forexFavorites')) || [];
            
            if (!favorites.includes(currentSymbol)) {
                favorites.push(currentSymbol);
                localStorage.setItem('forexFavorites', JSON.stringify(favorites));
                addFavoriteToDOM(currentSymbol);
            }
        }

        function addFavoriteToDOM(symbol) {
            const existing = Array.from(favoritesList.querySelectorAll('.favorite-item')).some(el => el.dataset.symbol === symbol);
            if (existing) return;
            
            const favoriteEl = document.createElement('div');
            favoriteEl.className = 'favorite-item flex justify-between items-center p-2 bg-gray-100 rounded cursor-pointer';
            favoriteEl.dataset.symbol = symbol;
            
            favoriteEl.innerHTML = `
                <span>${symbol}</span>
                <button class="remove-favorite text-red-500 hover:text-red-700">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            favoriteEl.addEventListener('click', function(e) {
                if (!e.target.closest('.remove-favorite')) {
                    symbolSelect.value = symbol;
                    currentSymbol = symbol;
                    currentSymbolEl.textContent = currentSymbol;
                    updatePrice();
                    updateSignalsAndEOD();
                    updateChart();
                }
            });
            
            favoriteEl.querySelector('.remove-favorite').addEventListener('click', function(e) {
                e.stopPropagation();
                removeFavorite(symbol);
            });
            
            // Insert after the favorites title
            const title = favoritesList.querySelector('h3');
            if (title.nextSibling) {
                favoritesList.insertBefore(favoriteEl, title.nextSibling);
            } else {
                favoritesList.appendChild(favoriteEl);
            }
            
            // Remove "no favorites" message if it exists
            const noFavoritesMsg = favoritesList.querySelector('p');
            if (noFavoritesMsg) {
                noFavoritesMsg.remove();
            }
        }

        function removeFavorite(symbol) {
            const favorites = JSON.parse(localStorage.getItem('forexFavorites')) || [];
            const updatedFavorites = favorites.filter(fav => fav !== symbol);
            localStorage.setItem('forexFavorites', JSON.stringify(updatedFavorites));
            
            const favoriteEl = favoritesList.querySelector(`.favorite-item[data-symbol="${symbol}"]`);
            if (favoriteEl) {
                favoriteEl.remove();
            }
            
            if (updatedFavorites.length === 0) {
                favoritesList.innerHTML += '<p class="text-gray-500 text-sm">No favorites yet</p>';
            }
        }

        function clearFavorites() {
            localStorage.removeItem('forexFavorites');
            favoritesList.innerHTML = '<h3 class="font-medium text-gray-700">Favorites</h3><p class="text-gray-500 text-sm">No favorites yet</p>';
        }
    </script>
</body>
</html>